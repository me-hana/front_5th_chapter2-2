import{r as j,j as e,c as V,R as A}from"./client-DD4c7S6m.js";const F=t=>t.reduce((d,s)=>Math.max(d,s.rate),0),I=t=>{const{discounts:d}=t.product,{quantity:s}=t;let n=0;for(const c of d)s>=c.quantity&&(n=Math.max(n,c.rate));return n},M=(t,d)=>{let s=0,n=0;t.forEach(r=>{const{price:g}=r.product,{quantity:m}=r;s+=g*m;const p=r.product.discounts.reduce((N,u)=>m>=u.quantity&&u.rate>N?u.rate:N,0);n+=g*m*(1-p)});let c=s-n;return d&&(d.discountType==="amount"?n=Math.max(0,n-d.discountValue):n*=1-d.discountValue/100,c=s-n),{totalBeforeDiscount:Math.round(s),totalAfterDiscount:Math.round(n),totalDiscount:Math.round(c)}},$=(t,d)=>{const s=d.find(n=>n.product.id===t.id);return t.stock-((s==null?void 0:s.quantity)||0)};function C(t,d){const[s,n]=j.useState(()=>{try{const c=localStorage.getItem(t);return c?JSON.parse(c):d}catch{return d}});return j.useEffect(()=>{try{localStorage.setItem(t,JSON.stringify(s))}catch(c){console.warn("useLocalStorage error:",c)}},[t,s]),[s,n]}const R=()=>{const[t,d]=C("cart",[]),[s,n]=C("coupon",null),c=u=>{const h=t.find(a=>a.product.id===u.id);return u.stock-((h==null?void 0:h.quantity)||0)};return{cart:t,addToCart:u=>{c(u)<=0||d(a=>a.find(l=>l.product.id===u.id)?a.map(l=>l.product.id===u.id?{...l,quantity:Math.min(l.quantity+1,u.stock)}:l):[...a,{product:u,quantity:1}])},removeFromCart:u=>{d(h=>h.filter(a=>a.product.id!==u))},updateQuantity:(u,h)=>{d(a=>a.map(i=>{if(i.product.id===u){const l=i.product.stock,b=Math.max(0,Math.min(h,l));return b>0?{...i,quantity:b}:null}return i}).filter(i=>i!==null))},applyCoupon:u=>{n(u)},calculateTotal:()=>M(t,s),selectedCoupon:s}},L=t=>{const[d,s]=j.useState(t);return{coupons:d,addCoupon:c=>{s(r=>[...r,c])}}},O=t=>{const[d,s]=j.useState(t);return{products:d,updateProduct:r=>{s(g=>g.map(m=>m.id===r.id?r:m))},addProduct:r=>{s(g=>[...g,r])}}},Q=(t,d)=>{const[s,n]=j.useState(null),[c,r]=j.useState({quantity:0,rate:0});return{editingProduct:s,setEditingProduct:n,newDiscount:c,setNewDiscount:r,startEditing:a=>n({...a}),updateField:(a,i,l)=>{(s==null?void 0:s.id)===a&&n({...s,[i]:l})},updateStock:(a,i)=>{const l=t.find(b=>b.id===a);if(l){const b={...l,stock:i};d(b),n(b)}},addDiscount:a=>{const i=t.find(l=>l.id===a);if(i&&s){const l={...i,discounts:[...i.discounts,c]};d(l),n(l),r({quantity:0,rate:0})}},removeDiscount:(a,i)=>{const l=t.find(b=>b.id===a);if(l){const b={...l,discounts:l.discounts.filter((w,v)=>v!==i)};d(b),n(b)}},completeEdit:()=>{s&&(d(s),n(null))}}},B=({products:t,coupons:d,onProductUpdate:s,onProductAdd:n,onCouponAdd:c})=>{const[r,g]=j.useState(new Set),[m,p]=j.useState({name:"",code:"",discountType:"percentage",discountValue:0}),[N,u]=j.useState(!1),[h,a]=j.useState({name:"",price:0,stock:0,discounts:[]}),{editingProduct:i,newDiscount:l,setNewDiscount:b,startEditing:w,updateField:v,updateStock:k,addDiscount:S,removeDiscount:q,completeEdit:D}=Q(t,s),P=o=>{g(y=>{const x=new Set(y);return x.has(o)?x.delete(o):x.add(o),x})},T=()=>{c(m),p({name:"",code:"",discountType:"percentage",discountValue:0})},E=()=>{const o={...h,id:Date.now().toString()};n(o),a({name:"",price:0,stock:0,discounts:[]}),u(!1)};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"관리자 페이지"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 관리"}),e.jsx("button",{onClick:()=>u(!N),className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:N?"취소":"새 상품 추가"}),N&&e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),e.jsx("input",{id:"productName",type:"text",value:h.name,onChange:o=>a({...h,name:o.target.value}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),e.jsx("input",{id:"productPrice",type:"number",value:h.price,onChange:o=>a({...h,price:parseInt(o.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),e.jsx("input",{id:"productStock",type:"number",value:h.stock,onChange:o=>a({...h,stock:parseInt(o.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:E,className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]}),e.jsx("div",{className:"space-y-2",children:t.map((o,y)=>e.jsxs("div",{"data-testid":`product-${y+1}`,className:"bg-white p-4 rounded shadow",children:[e.jsxs("button",{"data-testid":"toggle-button",onClick:()=>P(o.id),className:"w-full text-left font-semibold",children:[o.name," - ",o.price,"원 (재고: ",o.stock,")"]}),r.has(o.id)&&e.jsx("div",{className:"mt-2",children:i&&i.id===o.id?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"상품명: "}),e.jsx("input",{type:"text",value:i.name,onChange:x=>v(o.id,"name",x.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"가격: "}),e.jsx("input",{type:"number",value:i.price,onChange:x=>v(o.id,"price",parseInt(x.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"재고: "}),e.jsx("input",{type:"number",value:i.stock,onChange:x=>k(o.id,parseInt(x.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),i.discounts.map((x,f)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[x.quantity,"개 이상 구매 시"," ",x.rate*100,"% 할인"]}),e.jsx("button",{onClick:()=>q(o.id,f),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},f)),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",placeholder:"수량",value:l.quantity,onChange:x=>b({...l,quantity:parseInt(x.target.value)}),className:"w-1/3 p-2 border rounded"}),e.jsx("input",{type:"number",placeholder:"할인율 (%)",value:l.rate*100,onChange:x=>b({...l,rate:parseInt(x.target.value)/100}),className:"w-1/3 p-2 border rounded"}),e.jsx("button",{onClick:()=>S(o.id),className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]})]}),e.jsx("button",{onClick:D,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]}):e.jsxs("div",{children:[o.discounts.map((x,f)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[x.quantity,"개 이상 구매 시"," ",x.rate*100,"% 할인"]})},f)),e.jsx("button",{"data-testid":"modify-button",onClick:()=>w(o),className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})})]},o.id))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"쿠폰 관리"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"쿠폰 이름",value:m.name,onChange:o=>p({...m,name:o.target.value}),className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",placeholder:"쿠폰 코드",value:m.code,onChange:o=>p({...m,code:o.target.value}),className:"w-full p-2 border rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:m.discountType,onChange:o=>p({...m,discountType:o.target.value}),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"amount",children:"금액(원)"}),e.jsx("option",{value:"percentage",children:"할인율(%)"})]}),e.jsx("input",{type:"number",placeholder:"할인 값",value:m.discountValue,onChange:o=>p({...m,discountValue:parseInt(o.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:T,className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),e.jsx("div",{className:"space-y-2",children:d.map((o,y)=>e.jsxs("div",{"data-testid":`coupon-${y+1}`,className:"bg-gray-100 p-2 rounded",children:[o.name," (",o.code,"):",o.discountType==="amount"?`${o.discountValue}원`:`${o.discountValue}%`," ","할인"]},y))})]})]})]})]})]})},J=({item:t,onIncrease:d,onDecrease:s,onRemove:n})=>{const c=I(t);return e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:t.product.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[t.product.price,"원 x ",t.quantity,c>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",(c*100).toFixed(0),"% 할인 적용)"]})]})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:s,className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"-"}),e.jsx("button",{onClick:d,className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"+"}),e.jsx("button",{onClick:n,className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]})]})},W=({coupon:t,index:d})=>e.jsxs("option",{value:d,children:[t.name," -"," ",t.discountType==="amount"?`${t.discountValue}원`:`${t.discountValue}%`]}),_=({product:t,cart:d,onClick:s})=>{const n=$(t,d);return e.jsxs("div",{"data-testid":`product-${t.id}`,className:"bg-white p-3 rounded shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:t.name}),e.jsxs("span",{className:"text-gray-600",children:[t.price.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${n>0?"text-green-600":"text-red-600"}`,children:["재고: ",n,"개"]}),t.discounts.length>0&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",(F(t.discounts)*100).toFixed(0),"% 할인"]})]}),t.discounts.length>0&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:t.discounts.map((c,r)=>e.jsxs("li",{children:[c.quantity,"개 이상: ",(c.rate*100).toFixed(0),"% 할인"]},r))}),e.jsx("button",{onClick:s,className:`w-full px-3 py-1 rounded ${n>0?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:n<=0,children:n>0?"장바구니에 추가":"품절"})]})},z=({products:t,coupons:d})=>{const{cart:s,addToCart:n,removeFromCart:c,updateQuantity:r,applyCoupon:g,calculateTotal:m,selectedCoupon:p}=R(),{totalBeforeDiscount:N,totalAfterDiscount:u,totalDiscount:h}=m();return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"장바구니"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 목록"}),e.jsx("div",{className:"space-y-2",children:t.map(a=>e.jsx(_,{product:a,cart:s,onClick:()=>n(a)},a.id))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"장바구니 내역"}),e.jsx("div",{className:"space-y-2",children:s.map(a=>e.jsx(J,{item:a,onIncrease:()=>r(a.product.id,a.quantity+1),onDecrease:()=>r(a.product.id,a.quantity-1),onRemove:()=>c(a.product.id)},a.product.id))}),e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"쿠폰 적용"}),e.jsxs("select",{onChange:a=>g(d[parseInt(a.target.value)]),className:"w-full p-2 border rounded mb-2",children:[e.jsx("option",{value:"",children:"쿠폰 선택"}),d.map((a,i)=>e.jsx(W,{coupon:a,index:i},a.code))]}),p&&e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",p.name,"(",p.discountType==="amount"?`${p.discountValue}원`:`${p.discountValue}%`," ","할인)"]})]}),e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"주문 요약"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",N.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",h.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",u.toLocaleString(),"원"]})]})]})]})]})]})},G=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],H=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],K=()=>{const{products:t,updateProduct:d,addProduct:s}=O(H),{coupons:n,addCoupon:c}=L(G),[r,g]=j.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("nav",{className:"bg-blue-600 text-white p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"쇼핑몰 관리 시스템"}),e.jsx("button",{onClick:()=>g(!r),className:"bg-white text-blue-600 px-4 py-2 rounded hover:bg-blue-100",children:r?"장바구니 페이지로":"관리자 페이지로"})]})}),e.jsx("main",{className:"container mx-auto mt-6",children:r?e.jsx(B,{products:t,coupons:n,onProductUpdate:d,onProductAdd:s,onCouponAdd:c}):e.jsx(z,{products:t,coupons:n})})]})};V.createRoot(document.getElementById("root")).render(e.jsx(A.StrictMode,{children:e.jsx(K,{})}));
